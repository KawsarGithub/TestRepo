(function(n,t,i){"use strict";t.templateSettings={interpolate:/\{\{(.+?)\}\}/g};n(function(){function tt(){c.val("");w.fadeOut();p.slideUp(function(){y.slideDown()})}function it(n){nt.text(n);y.slideUp(function(){p.slideDown(function(){c.select().focus()});w.fadeIn()})}function s(n){return t(f).findWhere({id:n})}function h(n){return e.find('tr[data-id="'+n+'"]')}function rt(i){var r=t(i).reduce(function(n,t){return n+o(t)},"");e.empty().append(n.parseHTML(r))}function a(t){h(t).animate({backgroundColor:"#ffff99"},function(){n(this).slideDown(function(){n(this).css({backgroundColor:""})})})}function d(t){h(t).animate({backgroundColor:"#fb6c6c"},function(){n(this).slideUp(function(){n(this).remove()})})}function g(n){var r=s(n),i;r&&((i=t(f).indexOf(r),i<0)||f.splice(i,1))}function ut(){var t=l.find('input[name="name"]'),u=l.find('textarea[name="description"]'),i=l.find('input[name="price"]');if(!t.val()){t.select().focus();return}if(!i.val()){i.select().focus();return}r.server.add(t.val(),u.val(),i.val()).done(function(r){t.val("");u.val("");i.val("");f.push(r);e.append(n.parseHTML(o(r)));a(r.id)})}function ft(n){confirm("Are you sure you want to delete this row?")&&r.server.delete(n).done(function(){g(n);d(n)})}function et(t,i){var f=s(t),r=n(n.parseHTML(k(f)));u&&v(u,h(u));i.replaceWith(r);r.find("input,textarea").first().select().focus();u=t}function v(t,i){var r=s(t),f=n(n.parseHTML(o(r)));i.replaceWith(f);u=void 0}function ot(n,t){var f=s(n),i=t.find('input[name="name"]'),e=t.find('textarea[name="description"]'),u=t.find('input[name="price"]');if(!i.val()){i.select().focus();return}if(!u.val()){u.select().focus();return}r.server.update(n,i.val(),e.val(),u.val()).done(function(){f.name=i.val();f.description=e.val();f.price=u.val();v(n,t);a(n)})}function st(n,t){t.id===u?(i.error(n+' has already deleted "'+t.name+'", so we are reverting the edit.'),v(u,h(u))):i.warning(n+' has deleted "'+t.name+'".');g(t.id);d(t.id)}function ht(t,r){i.success(t+' has added "'+r.name+'".');f.push(r);e.append(n.parseHTML(o(r)));a(r.id)}function ct(t,r){var f=s(r.id),e;r.id===u?(e=k,i.error(t+' has already updated "'+f.name+'", so we are loading the updated data in edit.')):(e=o,i.success(t+' has updated "'+f.name+'".'));f.name=r.name;f.description=r.description;f.price=r.price;h(r.id).replaceWith(n.parseHTML(e(r)));a(r.id)}var y=n("#login-box"),p=n("#logout-box"),c=n("#handle-edit"),nt=n("#handle-display"),w=n("#data"),b=n("#product-list"),e=b.find("tbody"),l=b.find("tfoot"),o=t(n("#display-row-template").html()).template(),k=t(n("#edit-row-template").html()).template(),r=n.connection.productsHub,f,u;p.submit(function(n){n.preventDefault();r.server.leave().done(function(){tt()})});e.on("click","button[data-command]",function(t){var f=n(t.currentTarget),u=f.closest("tr"),i=u.attr("data-id"),r;(t.preventDefault(),i)&&(r=f.attr("data-command"),r==="edit"?et(i,u):r==="delete"?ft(i):r==="cancel"?v(i,u):r==="update"&&ot(i,u))});l.find("button").click(ut);r.client.joined=function(n){i.info(n+" has joined.")};r.client.left=function(n){i.info(n+" has left.")};r.client.onDataAction=function(n,t,i){n==="deleted"?st(t,i):n==="added"?ht(t,i):n==="updated"&&ct(t,i)};n.connection.hub.start().done(function(){y.submit(function(n){var t=c.val();if(n.preventDefault(),!t){c.focus();return}r.server.join(t).done(function(){it(t);r.server.all().done(function(n){f=n;rt(f)})})})})})})(jQuery,_,toastr);
/*
//# sourceMappingURL=products.min.js.map
*/